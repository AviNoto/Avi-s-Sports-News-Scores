<!DOCTYPE html>
<html lang="en">

<head>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-SgOJa3DmI69IUzQ2PVdRZhwQ+dy64/BUtbMJw1MZ8t5HZApcHrRKUc4W0kG879m7" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/js/bootstrap.bundle.min.js" integrity="sha384-k6d4wzSIapyDyv1kpU366/PK5hCdSbCRGRCMv+eplOQJWyd1fbcAu9OCUj5zNLiq" crossorigin="anonymous"></script>
    <link href="styles.css" rel="stylesheet">
    <title>Avi's Sports News & Scores</title>
    <!-- favicon -->
    <link rel="icon" type="image/png" href="https://i.imgur.com/8V78FHG.png">
    <style>
        body {
          /* Replace with your background image URL */
          background-image: url('https://athlonsports.com/.image/t_share/MjEyNDcyODI2OTcwNTE0OTUz/usatsi_25165105.jpg');
          background-size: cover;
          background-position: top center;
          background-repeat: no-repeat;
          background-color: rgba(0, 0, 0, 0.5);
        }
      </style>
</head>

<body class="indent">
    <a href="index.html">
        <img src="https://i.imgur.com/8V78FHG.png"
             alt="Avi's Sports News & Scores logo"
             class="site-logo">
    </a>
    <h1><a href="index.html" style="color: inherit; text-decoration: none;">Avi's Sports News & Scores</a></h1>
    <nav class="indent-top navbar navbar-expand-lg">
        <div>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
                <div class="navbar-nav">
                    <a class="nav-link" href="nfl.html">NFL</a>
                    <a class="nav-link" href="nba.html">NBA</a>
                    <a class="nav-link" href="mlb.html">MLB</a>
                    <a class="nav-link" href="nhl.html">NHL</a>
                    <a class="nav-link active fw-bold" aria-current="page" href="ncaaf.html">NCAAF</a>
                    <a class="nav-link" href="ncaam.html">NCAAM</a>
                    <a class="nav-link" href="ncaaw.html">NCAAW</a>
                </div>
            </div>
        </div>
    </nav>
    <h2>
        College Football
        <img src="https://a.espncdn.com/redesign/assets/img/icons/ESPN-icon-football-college.png"
             alt="College Football logo"
             style="height:40px; margin-left:2px;">
      </h2>

    <label for="teams">Team:</label>
    <select name="teams" id="teams">
        <option value="select">Select a Team</option>
        <option value="airforce">Air Force Falcons</option>
        <option value="akron">Akron Zips</option>
        <option value="alabama">Alabama Crimson Tide</option>
        <option value="appalachianstate">Appalachian State Mountaineers</option>
        <option value="arizona">Arizona Wildcats</option>
        <option value="arizonastate">Arizona State Sun Devils</option>
        <option value="arkansas">Arkansas Razorbacks</option>
        <option value="arkansasstate">Arkansas State Red Wolves</option>
        <option value="army">Army Black Knights</option>
        <option value="auburn">Auburn Tigers</option>
        <option value="ballstate">Ball State Cardinals</option>
        <option value="baylor">Baylor Bears</option>
        <option value="boisestate">Boise State Broncos</option>
        <option value="bostoncollege">Boston College Eagles</option>
        <option value="bowlinggreen">Bowling Green Falcons</option>
        <option value="buffalo">Buffalo Bulls</option>
        <option value="byu">BYU Cougars</option>
        <option value="california">California Golden Bears</option>
        <option value="centralmichigan">Central Michigan Chippewas</option>
        <option value="charlotte49ers">Charlotte 49ers</option>
        <option value="cincinnati">Cincinnati Bearcats</option>
        <option value="clemson">Clemson Tigers</option>
        <option value="coastalcarolina">Coastal Carolina Chanticleers</option>
        <option value="colorado">Colorado Buffaloes</option>
        <option value="coloradostate">Colorado State Rams</option>
        <option value="duke">Duke Blue Devils</option>
        <option value="eastcarolina">East Carolina Pirates</option>
        <option value="easternmichigan">Eastern Michigan Eagles</option>
        <option value="floridaatlantic">Florida Atlantic Owls</option>
        <option value="fiu">FIU Panthers</option>
        <option value="florida">Florida Gators</option>
        <option value="floridastate">Florida State Seminoles</option>
        <option value="fresnostate">Fresno State Bulldogs</option>
        <option value="georgia">Georgia Bulldogs</option>
        <option value="georgiasouthern">Georgia Southern Eagles</option>
        <option value="georgiastate">Georgia State Panthers</option>
        <option value="georgiatech">Georgia Tech Yellow Jackets</option>
        <option value="hawaii">Hawaii Rainbow Warriors</option>
        <option value="houston">Houston Cougars</option>
        <option value="illinois">Illinois Fighting Illini</option>
        <option value="indiana">Indiana Hoosiers</option>
        <option value="iowa">Iowa Hawkeyes</option>
        <option value="iowastate">Iowa State Cyclones</option>
        <option value="jacksonvillestate">Jacksonville State Gamecocks</option>
        <option value="jamesmadison">James Madison Dukes</option>
        <option value="kansas">Kansas Jayhawks</option>
        <option value="kansasstate">Kansas State Wildcats</option>
        <option value="kennesawstate">Kennesaw State Owls</option>
        <option value="kentstate">Kent State Golden Flashes</option>
        <option value="kentucky">Kentucky Wildcats</option>
        <option value="liberty">Liberty Flames</option>
        <option value="louisianaragicajuns">Louisiana Ragin' Cajuns</option>
        <option value="louisianamonroe">Louisiana-Monroe Warhawks</option>
        <option value="louisianatech">Louisiana Tech Bulldogs</option>
        <option value="louisville">Louisville Cardinals</option>
        <option value="lsu">LSU Tigers</option>
        <option value="marshall">Marshall Thundering Herd</option>
        <option value="maryland">Maryland Terrapins</option>
        <option value="memphis">Memphis Tigers</option>
        <option value="miamifl">Miami (FL) Hurricanes</option>
        <option value="miamioh">Miami (OH) RedHawks</option>
        <option value="michigan">Michigan Wolverines</option>
        <option value="michiganstate">Michigan State Spartans</option>
        <option value="middletennessee">Middle Tennessee Blue Raiders</option>
        <option value="minnesota">Minnesota Golden Gophers</option>
        <option value="mississippistate">Mississippi State Bulldogs</option>
        <option value="missouri">Missouri Tigers</option>
        <option value="navy">Navy Midshipmen</option>
        <option value="ncstate">NC State Wolfpack</option>
        <option value="nebraska">Nebraska Cornhuskers</option>
        <option value="nevada">Nevada Wolf Pack</option>
        <option value="newmexico">New Mexico Lobos</option>
        <option value="newmexicostate">New Mexico State Aggies</option>
        <option value="northcarolina">North Carolina Tar Heels</option>
        <option value="northtexas">North Texas Mean Green</option>
        <option value="northernillinois">Northern Illinois Huskies</option>
        <option value="northwestern">Northwestern Wildcats</option>
        <option value="notredame">Notre Dame Fighting Irish</option>
        <option value="ohiobobcats">Ohio Bobcats</option>
        <option value="ohio">Ohio State Buckeyes</option>
        <option value="oklahoma">Oklahoma Sooners</option>
        <option value="oklahomastate">Oklahoma State Cowboys</option>
        <option value="olddominion">Old Dominion Monarchs</option>
        <option value="olemiss">Ole Miss Rebels</option>
        <option value="oregon">Oregon Ducks</option>
        <option value="oregonstate">Oregon State Beavers</option>
        <option value="pennstate">Penn State Nittany Lions</option>
        <option value="pittsburgh">Pittsburgh Panthers</option>
        <option value="purdue">Purdue Boilermakers</option>
        <option value="rice">Rice Owls</option>
        <option value="rutgers">Rutgers Scarlet Knights</option>
        <option value="samhouston">Sam Houston Bearkats</option>
        <option value="sandiegostate">San Diego State Aztecs</option>
        <option value="sanjosestate">San Jose State Spartans</option>
        <option value="smu">SMU Mustangs</option>
        <option value="southalabama">South Alabama Jaguars</option>
        <option value="southcarolina">South Carolina Gamecocks</option>
        <option value="southflorida">South Florida Bulls</option>
        <option value="southernmiss">Southern Miss Golden Eagles</option>
        <option value="stanford">Stanford Cardinal</option>
        <option value="syracuse">Syracuse Orange</option>
        <option value="tcu">TCU Horned Frogs</option>
        <option value="temple">Temple Owls</option>
        <option value="tennessee">Tennessee Volunteers</option>
        <option value="texas">Texas Longhorns</option>
        <option value="texasam">Texas A&M Aggies</option>
        <option value="texasstate">Texas State Bobcats</option>
        <option value="texastech">Texas Tech Red Raiders</option>
        <option value="toledo">Toledo Rockets</option>
        <option value="troy">Troy Trojans</option>
        <option value="tulane">Tulane Green Wave</option>
        <option value="tulsa">Tulsa Golden Hurricane</option>
        <option value="uab">UAB Blazers</option>
        <option value="ucf">UCF Knights</option>
        <option value="ucla">UCLA Bruins</option>
        <option value="uconn">UConn Huskies</option>
        <option value="umass">UMass Minutemen</option>
        <option value="unlv">UNLV Rebels</option>
        <option value="usc">USC Trojans</option>
        <option value="utah">Utah Utes</option>
        <option value="utahstate">Utah State Aggies</option>
        <option value="utep">UTEP Miners</option>
        <option value="utsa">UTSA Roadrunners</option>
        <option value="vanderbilt">Vanderbilt Commodores</option>
        <option value="virginia">Virginia Cavaliers</option>
        <option value="virginiatech">Virginia Tech Hokies</option>
        <option value="wakeforest">Wake Forest Demon Deacons</option>
        <option value="washington">Washington Huskies</option>
        <option value="washingtonstate">Washington State Cougars</option>
        <option value="westvirginia">West Virginia Mountaineers</option>
        <option value="westernkentucky">Western Kentucky Hilltoppers</option>
        <option value="westernmichigan">Western Michigan Broncos</option>
        <option value="wisconsin">Wisconsin Badgers</option>
        <option value="wyoming">Wyoming Cowboys</option>
    </select>
    <div id="resultsSection" style="display: none;">
    <h3>
        Team Record:
        <span id="record"></span>
        <img id="teamLogo" alt="Team logo" style="height:60px; margin-left:10px; display:none;">
      </h3>
      <h3>Recent Games:</h3>
      <table id="gamesTable" class="table table-sm"></table>
      <h3 id="headlinesTitle">News:</h3>
      <ul id="headlinesList"></ul>
      </div>

    <script>
        document.getElementById('teams').addEventListener('change', function () {
            const selectedTeam = this.value;
            if (selectedTeam !== "select") {
                fetchLatestGame(selectedTeam);
                fetchLatestHeadlines(selectedTeam);
            fetchTeamColor(selectedTeam);
            document.getElementById('resultsSection').style.display = '';
            document.body.style.backgroundImage = 'none';
            document.getElementById('teams').style.backgroundColor = 'rgba(0, 0, 0, 0)';
            } else {
                document.body.style.backgroundImage = "url('https://athlonsports.com/.image/t_share/MjEyNDcyODI2OTcwNTE0OTUz/usatsi_25165105.jpg')";
                document.body.style.backgroundColor = "rgba(0, 0, 0, 0.5)";
                document.body.style.color = "white";
                document.getElementById('record').innerText = "";
                document.getElementById('gamesTable').innerHTML = "";
                document.getElementById('headlinesList').innerHTML = "";
                const logoElem = document.getElementById('teamLogo');
                logoElem.src = "";
                logoElem.style.display = "none";
                document.getElementById('resultsSection').style.display = 'none';
                document.getElementById('teams').style.backgroundColor = 'rgba(0, 0, 0, 0.5)';
            }
        });

        const teamMappings = {
            "airforce": 2005, "akron": 2006, "alabama": 333, "appalachianstate": 2026, "arizona": 12, "arizonastate": 9,
            "arkansas": 8, "arkansasstate": 2032, "army": 349, "auburn": 2, "ballstate": 2050, "baylor": 239,
            "boisestate": 68, "bostoncollege": 103, "bowlinggreen": 189, "buffalo": 2084, "byu": 252, "california": 25,
            "centralmichigan": 2117, "charlotte49ers": 2429, "cincinnati": 2132, "clemson": 228, "coastalcarolina": 324, "colorado": 38,
            "coloradostate": 36, "duke": 150, "eastcarolina": 151, "easternmichigan": 2199, "floridaatlantic": 2226, "fiu": 2229,
            "florida": 57, "floridastate": 52, "fresnostate": 278, "georgia": 61, "georgiasouthern": 290, "georgiastate": 2247,
            "georgiatech": 59, "hawaii": 62, "houston": 248, "illinois": 356, "indiana": 84, "iowa": 2294,
            "iowastate": 66, "jacksonvillestate": 55, "jamesmadison": 256, "kansas": 2305, "kansasstate": 2306, "kennesawstate": 338,
            "kentstate": 2309, "kentucky": 96, "liberty": 2335, "louisianaragicajuns": 309, "louisianamonroe": 2433, "louisianatech": 2348,
            "louisville": 97, "lsu": 99, "marshall": 276, "maryland": 120, "memphis": 235, "miamifl": 2390,
            "miamioh": 193, "michigan": 130, "michiganstate": 127, "middletennessee": 2393, "minnesota": 135, "mississippistate": 344,
            "missouri": 142, "navy": 2426, "ncstate": 152, "nebraska": 158, "nevada": 2440, "newmexico": 167,
            "newmexicostate": 166, "northcarolina": 153, "northtexas": 249, "northernillinois": 2459, "northwestern": 77, "notredame": 87,
            "ohiobobcats": 195, "ohio": 194, "oklahoma": 201, "oklahomastate": 197, "olddominion": 295, "olemiss": 145,
            "oregon": 2483, "oregonstate": 204, "pennstate": 213, "pittsburgh": 221, "purdue": 2509, "rice": 242,
            "rutgers": 164, "samhouston": 2534, "sandiegostate": 21, "sanjosestate": 23, "smu": 2567, "southalabama": 6,
            "southcarolina": 2579, "southflorida": 58, "southernmiss": 2572, "stanford": 24, "syracuse": 183, "tcu": 2628,
            "temple": 218, "tennessee": 2633, "texas": 251, "texasam": 245, "texasstate": 326, "texastech": 2641,
            "toledo": 2649, "troy": 2653, "tulane": 2655, "tulsa": 202, "uab": 5, "ucf": 2116,
            "ucla": 26, "uconn": 41, "umass": 113, "unlv": 2439, "usc": 30, "utah": 254,
            "utahstate": 328, "utep": 2638, "utsa": 2636, "vanderbilt": 238, "virginia": 258, "virginiatech": 259,
            "wakeforest": 154, "washington": 264, "washingtonstate": 265, "westvirginia": 277, "westernkentucky": 98, "westernmichigan": 2711,
            "wisconsin": 275, "wyoming": 2751
        };

        // helper to pick the best logo URL
        const getLogoUrl = t => t.logo ?? t.logos?.[0]?.href ?? "";

        function updateRecord(games, teamId) {
            const teamEspnId = teamMappings[teamId];
            let wins = 0;
            let losses = 0;

            games.forEach((game, index) => {
                console.log("game", index, " - ", game);

                const competitors = game.competitions[0].competitors;
                let selectedTeamObj = null;
                let opponentTeam = null;

                competitors.forEach(currentTeam => {
                    if (currentTeam.team.id == teamEspnId) {
                        selectedTeamObj = currentTeam;
                    } else {
                        opponentTeam = currentTeam;
                    }
                });

                let selectedTeamScore = selectedTeamObj?.score ? parseInt(selectedTeamObj.score.value) : 0;
                let opponentScore = opponentTeam?.score ? parseInt(opponentTeam.score.value) : 0;

                console.log(selectedTeamScore);
                console.log(opponentScore);

                if (selectedTeamScore > opponentScore) {
                    wins++;
                } else if (selectedTeamScore < opponentScore) {
                    losses++;
                }
            });

            document.getElementById('record').innerText = `${wins}-${losses}`;
        }

        async function fetchLatestGame(teamId) {
            try {

                const teamEspnId = teamMappings[teamId];
                let teamLogoUrl = "";
                let teamDisplayName = "";

                const [regularSeasonResponse, playoffResponse] = await Promise.all([
                    fetch(`https://site.api.espn.com/apis/site/v2/sports/football/college-football/teams/${teamEspnId}/schedule?season=2024&seasontype=2`),
                    fetch(`https://site.api.espn.com/apis/site/v2/sports/football/college-football/teams/${teamEspnId}/schedule?season=2024&seasontype=3`)
                ]);

                const regularSeasonData = await regularSeasonResponse.json();
                const playoffData = await playoffResponse.json();

                const allGames = [...(regularSeasonData.events || []), ...(playoffData.events || [])];

                if (allGames.length === 0) {
                    document.getElementById('gamesTable').innerHTML =
                      `<thead><tr><th>Date</th><th>Team</th><th>Score</th><th>Opponent</th><th>W/L</th></tr></thead>
                       <tbody><tr><td colspan="5">No games found.</td></tr></tbody>`;
                    return;
                }

                const completedGames = allGames.filter(game =>
                    game.competitions[0].status.type.completed === true
                );

                if (completedGames.length === 0) {
                    document.getElementById('gamesTable').innerHTML =
                      `<thead><tr><th>Date</th><th>Team</th><th>Score</th><th>Opponent</th><th>W/L</th></tr></thead>
                       <tbody><tr><td colspan="5">No completed games available.</td></tr></tbody>`;
                    return;
                }

                completedGames.sort((a, b) =>
                    new Date(b.competitions[0].date) - new Date(a.competitions[0].date)
                );

                updateRecord(completedGames, teamId);

                const recentGames = completedGames.slice(0, 5);

                const rowsHtml = recentGames.map(game => {
                    const comps = game.competitions[0].competitors;
                    const selObj = comps.find(t => t.team.id == teamEspnId);
                    const oppObj = comps.find(t => t.team.id != teamEspnId);
                    if (!teamLogoUrl) {
                        teamLogoUrl     = getLogoUrl(selObj.team);
                        teamDisplayName = selObj.team.displayName;
                    }
                    const selScore = selObj.score ? +selObj.score.value : 0;
                    const oppScore = oppObj.score ? +oppObj.score.value : 0;
                    const result   = selScore > oppScore ? "W" : "L";
                    const date     = new Date(game.date).toLocaleDateString(undefined,
                        {year:'numeric', month:'short', day:'numeric'});
                    return `<tr>
                                <td>${date}</td>
                                <td><img src="${getLogoUrl(selObj.team)}" style="height:30px;margin-right:4px;">${selObj.team.displayName}</td>
                                <td>${selScore}-${oppScore}</td>
                                <td><img src="${getLogoUrl(oppObj.team)}" style="height:30px;margin-right:4px;">${oppObj.team.displayName}</td>
                                <td>${result}</td>
                            </tr>`;
                }).join("");
                document.getElementById('gamesTable').innerHTML =
                  `<thead><tr><th>Date</th><th>Team</th><th>Score</th><th>Opponent</th><th>W/L</th></tr></thead><tbody>${rowsHtml}</tbody>`;
                // show team crest next to record
                if (teamLogoUrl) {
                    const logoElem = document.getElementById('teamLogo');
                    logoElem.src = teamLogoUrl;
                    logoElem.alt = teamDisplayName + " logo";
                    logoElem.style.display = "inline-block";
                }

            } catch (error) {
                document.getElementById('gamesTable').innerHTML =
                  `<thead><tr><th>Date</th><th>Team</th><th>Score</th><th>Opponent</th><th>W/L</th></tr></thead>
                   <tbody><tr><td colspan="5">Error fetching game data.</td></tr></tbody>`;
                console.error("Error fetching game:", error);
            }
        }

        async function fetchLatestHeadlines(teamId) {
            try {

                const teamEspnId = teamMappings[teamId];

                const response = await fetch(`https://site.api.espn.com/apis/site/v2/sports/football/college-football/news?team=${teamEspnId}`);
                const data = await response.json();

                const headlinesList = document.getElementById('headlinesList');
                headlinesList.innerHTML = '';

                const nonPremiumArticles = data.articles.filter(article => !article.premium);

                if (nonPremiumArticles.length > 0) {
                    const recentHeadlines = nonPremiumArticles.slice(0, 3);
                    recentHeadlines.forEach(article => {
                        const listItem = document.createElement('li');
                        // add date prefix
                        const dateStr = new Date(
                            article.published || article.lastModified || article.updated
                        ).toLocaleDateString(undefined, {
                            year: 'numeric', month: 'short', day: 'numeric'
                        });
                        listItem.innerHTML = `${dateStr}: `;
                        const link = document.createElement('a');
                        link.href = article.links.web.href;
                        link.innerText = article.headline;
                        link.target = "_blank";
                        listItem.appendChild(link);
                        headlinesList.appendChild(listItem);
                    });
                } else {
                    headlinesList.innerText = "No recent headlines available.";
                }

            } catch (error) {
                document.getElementById('headlinesList').innerText = "Error fetching headlines.";
                console.error("Error fetching headlines:", error);
            }
        }

        async function fetchTeamColor(teamId) {
            try {
                const teamEspnId = teamMappings[teamId];
                const response = await fetch(`https://site.api.espn.com/apis/site/v2/sports/football/college-football/teams/${teamEspnId}`);
                const data = await response.json();

                // ESPN returns a hex color string without the leading '#'
                const colorHex = (data.team && data.team.color) || data.color || "FFFFFF";
                const altColorHex = (data.team && data.team.alternateColor) || data.alternateColor || "000000";
                document.body.style.backgroundColor = "#" + colorHex;
                document.body.style.color = "#" + altColorHex;
                document.body.style.backgroundImage = "none";
                document.getElementById('teams').style.backgroundColor = 'rgba(0, 0, 0, 0)';
            } catch (error) {
                console.error("Error fetching team color:", error);
                document.body.style.backgroundImage = "url('https://athlonsports.com/.image/t_share/MjEyNDcyODI2OTcwNTE0OTUz/usatsi_25165105.jpg')";
                document.body.style.backgroundColor = "rgba(0, 0, 0, 0.5)";
                document.body.style.color = "white";
                document.getElementById('teams').style.backgroundColor = 'rgba(0, 0, 0, 0.5)';
            }
        }

        // Initial data is not loaded until a team is selected.
    </script>
</body>

</html>
